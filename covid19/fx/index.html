<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="//api.map.baidu.com/api?v=3.0&ak=TgV2QFgm0rUs6MM5ZujGFvVUiyQUWhjD"></script>
    <script type="text/javascript" src="//apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://mapv.baidu.com/build/mapv.min.js"></script>
    <script src="https://code.bdstatic.com/npm/mapvgl@1.0.0-beta.146/dist/mapvgl.min.js"></script>
    <script src="../../js/common.js"></script>

    <title>SH 奉贤 疫情趋势</title>
    <style>
       body,html{
           width: 100%;
           height: 100%;
           padding: 0;
           margin: 0;
       }
       #container{
           width: 100%;
           height: 100%;
           overflow: hidden;
       }
       #result{
           position: fixed;
           top: 10px;
           right: 10px;
           width: 100px;
           height: 480px;
           line-height: 30px;
           text-align: center;
           background: #fff;
           box-shadow: 0 2px 6px 0 rgba(27, 142, 236, 0.5);
           border-radius: 7px;
           z-index: 99;
       }
      #result>div:first-child{
            width: 100%;
            height: 40px;
            text-align: center;
            line-height: 40px;
            background: #00BFFF;
            border-radius: 7px 7px 0px 0px;
            color: #fff;
      }
      #result ul{
           list-style-type: none;
           margin: 0;
           padding: 0;
      }
      #result ul li{
           color: #000;
           padding: 7px;
           font-size: 14px;
           text-align: justify;
           border-bottom: 1px solid #D3D3D3  
      }
      #result>div:last-child{
          display: flex;
          align-items: center;
          justify-content: flex-end;
          padding: 10px;
      }
      .btn{ 
          width: 50px;
          height: 35px;
          color: #fff;
          font-size: 14px;
          border-radius: 5px;
          background: #00BFFF;
          box-shadow: none;
      }
      .btn:hover{
          cursor: pointer;
      }
    </style>
</head>
<body>
    <div id='container'></div>
    <div id='result'>
	<div>每日</div>
	<div><button onclick='show_mark_only("0408")' class='btn'>4.8</button></div>
	<div><button onclick='show_mark_only("0407")' class='btn'>4.7</button></div>
	<div><button onclick='show_mark_only("0406")' class='btn'>4.6</button></div>
	<div><button onclick='show_mark_only("0405")' class='btn'>4.5</button></div>
	<div><button onclick='show_mark_only("0404")' class='btn'>4.4</button></div>
	<div><button onclick='show_mark_only("0403")' class='btn'>4.3</button></div>
	<div><button onclick='show_mark_only("0402")' class='btn'>4.2</button></div>
	<div><button onclick='show_mark_only("0401")' class='btn'>4.1</button></div>
	<div><button onclick='show_mark_only("0331")' class='btn'>3.31</button></div>
	<div><button onclick='show_mark_only("0330")' class='btn'>3.30</button></div>
	<div><button onclick='show_mark_only("0329")' class='btn'>3.29</button></div>
	<div><button onclick='show_mark_only("0328")' class='btn'>3.28</button></div>
	<div><button onclick='show_all()' class='btn'>3.28~</button></div>

    </div>
	<script>
	//var map = new BMapGL.Map('container');
	var map = initMap({
            style: whiteStyle,
            tilt: 10,
            center: [121.422,30.993],
            zoom: 13,
            skyColors: [
                // 地面颜色
                'rgba(226, 237, 248, 0)',
                // 天空颜色
                'rgba(186, 211, 252, 1)'
            ]
        });	
	//map.centerAndZoom(new BMap.Point(121.422,30.993), 13);
	map.enableScrollWheelZoom(true);
	var myIcon = new BMap.Icon("../../img/poi-icon-s.png", new BMap.Size(20, 22));
		
	function show_mark_only(date){
		map.clearOverlays();
		show_mark(date);
	}	
	function show_mark(date){
		
		var data = []
		$.get('../../data2/fx' + date + '.geojson', function(geojson) {

			var geojsonDataSet = mapv.geojson.getDataSet(geojson);
			darray = geojsonDataSet._data
			var data_len = darray.length
			for (var j = 0; j < data_len; j++) {
				data.push({
					geometry: {
					    type: 'Point',
					    coordinates: [darray[data_len].geometry.coordinates[0], darray[data_len].geometry.coordinates[1]]
					},
					properties: {
					    icon: [
						'../../img/poi-icon-s.png'
					    ]
					}
				    });
			}
		});
		var view = new mapvgl.View({ map: map });

		var clusterLayer = new mapvgl.ClusterLayer({
		    minSize: 30, // 聚合点显示的最小直径
		    maxSize: 50, // 聚合点显示的最大直径
		    clusterRadius: 150, // 聚合范围半径
		    gradient: {0: 'blue', 0.5: 'green', 1.0: 'red'}, // 聚合点颜色梯度
		    maxZoom: 15, // 聚合的最大级别，当地图放大级别高于此值将不再聚合
		    minZoom: 5, // 聚合的最小级别，当地图放大级别低于此值将不再聚合
		    // 是否显示文字
		    showText: true,
		    // 开始聚合的最少点数，点数多于此值才会被聚合
		    minPoints: 5,
		    // 设置文字样式
		    textOptions: {
			fontSize: 12,
			color: 'white',
			// 格式化数字显示
			format: function (count) {
			    return count >= 10000 ? Math.round(count / 1000) + 'k'
			    : count >= 1000 ? Math.round(count / 100) / 10 + 'k' : count;
			}
		    },
		    // 设置非聚合的点的icon
		    // iconOptions: {
		    //     width: 100 / 4,
		    //     height: 153 / 4,
		    //     icon: 'images/marker.png',
		    // },
		    enablePicked: true,
		    onClick(e) {
			if (e.dataItem) {
			    // 可通过dataItem下面的children属性拿到被聚合的所有点
			    console.log(e.dataItem);
			}
		    }
		});

		view.addLayer(clusterLayer);
		clusterLayer.setData(data);

		}

		function show_all(){
			map.clearOverlays();
			show_mark("0408");
			show_mark("0407");
			show_mark("0406");
			show_mark("0405");
			show_mark("0404");
			show_mark("0403");
			show_mark("0402");
			show_mark("0401");

			show_mark("0331");
			show_mark("0330");
			show_mark("0329");
			show_mark("0328");

		}

	</script>
</body>
</html>
